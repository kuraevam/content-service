stages:
  - staging
  - production

staging:
  stage: staging
  tags: [marketing-staging]
  script:
    - cat $ENV_STAGING > .env
    - docker compose down || true
    - docker compose up -d --build
    - docker restart nginx
  only:
    - main

production:
  stage: production
  tags: [marketing-production]
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_JOB_TOKEN $CI_REGISTRY
    - docker pull $TAG_COMMIT
    - docker container stop content-service
    - docker container rm content-service
    - docker run -d --network=marketing-network --name content-service --env-file $ENV_STAGING $TAG_COMMIT
    - docker restart nginx
  when: manual
  only:
    - main
